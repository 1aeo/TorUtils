<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The DirCache Dilemma: The Fix We Can't Reduce Guard Memory With | 1st Amendment Encrypted Openness</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; background-color: #121212; color: #ffffff; }
    .nav { background-color: #1e1e1e; padding: 10px 0; box-shadow: 0 2px 10px rgba(0, 255, 127, 0.2); position: sticky; top: 0; z-index: 1000; }
    .nav-toggle { display: none; background: none; border: none; font-size: 24px; color: #00ff7f; position: absolute; top: 10px; right: 20px; cursor: pointer; }
    .nav-links { display: flex; justify-content: center; flex-wrap: wrap; }
    .nav-links a { color: #00ff7f; text-decoration: none; margin: 0 15px; font-size: 18px; }
    .nav-links a:hover { text-decoration: underline; }
    @media (max-width: 600px) { .nav-links { display: none; flex-direction: column; margin-top: 40px; } .nav-links.show { display: flex; } .nav-toggle { display: block; } }
    .container { max-width: 800px; margin: 50px auto; padding: 20px; background: #1e1e1e; box-shadow: 0px 0px 15px rgba(0, 255, 127, 0.6); border-radius: 10px; text-align: left; }
    h1, h2, h3 { color: #00ff7f; }
    h1 { text-align: center; }
    p { font-size: 18px; color: #cccccc; line-height: 1.6; margin-bottom: 1em; }
    .meta { font-size: 14px; color: #888; margin-bottom: 20px; text-align: center; }
    ul, ol { color: #cccccc; margin-bottom: 1em; }
    li { font-size: 18px; margin-bottom: 8px; line-height: 1.6; }
    code { background-color: #2d2d2d; padding: 2px 6px; border-radius: 3px; font-family: monospace; color: #00ff7f; }
    a { color: #00ff7f; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .container img { display: block; margin: 20px auto; max-width: 100%; height: auto; border-radius: 5px; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #444; }
    th { background-color: #2d2d2d; color: #00ff7f; }
    td { color: #cccccc; }
    tr:hover { background-color: #252525; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #333; font-size: 14px; color: #777; text-align: center; }
    .btn { display: inline-block; margin-top: 20px; padding: 12px 24px; font-size: 18px; color: #121212; background-color: #00ff7f; text-decoration: none; font-weight: bold; border-radius: 5px; transition: background 0.3s; }
    .btn:hover { background-color: #00cc66; text-decoration: none; }
  </style>
</head>
<body>
  <div class="nav">
    <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('show')">&#9776;</button>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/blog">Blog</a>
      <a href="https://metrics.1aeo.com">Metrics</a>
      <a href="https://aroivalidator.1aeo.com">AROI Validator</a>
      <a href="https://routefluxmap.1aeo.com">RouteFluxMap</a>
      <a href="/#contact">Contact</a>
    </div>
  </div>

  <div class="container">
    <h1>The DirCache Dilemma: The Fix We Can't Reduce Guard Memory With</h1>
    <p class="meta"><em>By 1AEO Team â€¢ January 2026</em></p>

    <p class="meta"><em>Experiment: 13 relays over 9 days (Sept 9â€“18, 2025) on Ubuntu 24.04 with glibc allocator</em></p>

    <p>In September 2025 we investigated a pattern on our guard relays: memory looked normal after restart (~0.5 GB), then after ~48 hours RSS jumped and "stuck" around 5 GB. That's costly at fleet scale and a reliability risk.</p>

    <p>We tested a radical configuration: <code>DirCache 0</code>. The impact was immediate and dramatic.</p>

    <h2>What We Found</h2>
    <table>
      <thead>
        <tr><th>Configuration</th><th>Start RSS</th><th>End RSS</th><th>Change</th></tr>
      </thead>
      <tbody>
        <tr><td>DirCache 0</td><td>â€”</td><td>0.33 GB</td><td><strong>-93.8%</strong></td></tr>
        <tr><td>Control (default)</td><td>0.57 GB</td><td>5.14 GB</td><td>+802%</td></tr>
      </tbody>
    </table>

    <p>Memory remained stable for 9+ days with DirCache disabledâ€”no fragmentation, no gradual creep.</p>

    <img src="images/dircache-memory-trade-off-tor-guard-relays.png" alt="DirCache 0 vs Control Memory Usage">

    <h2>The Catch</h2>
    <p>There's no free lunch. Disabling DirCache instantly revokes your relay's Guard status. The network requires Guards to handle directory traffic, so you cannot turn this feature off to save RAM if you want to remain a Guard.</p>

    <h2>The Diagnostic Value</h2>
    <p>The control relay shows the signature "fragmentation spike" inside the ~48-hour window, while the <code>DirCache 0</code> relay remains flat. This experiment proved that memory isn't "leaking" in the traditional senseâ€”it's being <strong>fragmented by the churn of directory data</strong>.</p>

    <p>Since <code>DirCache 0</code> is incompatible with Guard operation, the practical path is allocator-level mitigation (jemalloc/mimalloc) so guards can keep caching <em>without</em> ballooning to 5â€“6 GB RSS.</p>

    <p>ðŸ“Š <strong>Raw data:</strong> <a href="https://github.com/1aeo/TorUtils/tree/main/memory/reports/2025-09-18-co-guard-fragmentation">View experiment data and relay configs on GitHub</a></p>

    <p style="text-align: center;"><a href="/#get-involved" class="btn">Join the Mission</a></p>

    <div class="footer">
      <p>Â© 2026 1st Amendment Encrypted Openness | Privacy First | No Logs | No Borders</p>
    </div>
  </div>
</body>
</html>
